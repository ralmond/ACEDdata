---
title: "RShinyCleaning"
---

Will use `dplyr` to pull data together into a big file, then pull off subsets for `shinyItemAnalysis`.

```{r}
library(dplyr)
```



# ACED Items

```{r}
allitems <- read.csv("data/allItems.csv")
bnscores <- read.csv("data/bnscores.csv")
demographics <- read.csv("data/prepost.csv")
demographics |> inner_join(allitems,join_by(SubjID)) |>
  inner_join(bnscores,join_by(SubjID)) ->
  acedall
acedall                             # Only useful in interactive mode.
```


## Data -- items only

```{r}
select(acedall,starts_with("t")) |>
  write.csv("data/shinyACED/acedItems.csv",row.names=FALSE)
```

### Item Subsets

63 items is too many for Wright Map, so break
into subscales.

```{r}
select(acedall,contains("Solve")) |>
  write.csv("data/shinyACED/sgpItems.csv",row.names=FALSE)
```

```{r}
select(acedall,contains("Ratio")) |>
  write.csv("data/shinyACED/crItems.csv",row.names=FALSE)
```

```{r}
select(acedall,matches("Solve|Ratio")) |>
  write.csv("data/shinyACED/sgpcrItems.csv",row.names=FALSE)
```

```{r}
select(acedall,contains("Ratio")) |>
  write.csv("data/shinyACED/crItems.csv",row.names=FALSE)
```



```{r}
select(acedall,contains("Example")) |>
  write.csv("data/shinyACED/egItems.csv")
```

```{r}
select(acedall,contains("Explicit")) |>
  write.csv("data/shinyACED/expItems.csv")
```

```{r}
select(acedall,contains("Extend")) |>
  write.csv("data/shinyACED/extItems.csv")
```

```{r}
select(acedall,contains("Model")) |>
  write.csv("data/shinyACED/modItems.csv")
```

```{r}
select(acedall,contains("Recursive")) |>
  write.csv("data/shinyACED/rrItems.csv")
```

```{r}
select(acedall,contains("Table")) |>
  write.csv("data/shinyACED/tabItems.csv")
```
```{r}
select(acedall,contains("Verbal")) |>
  write.csv("data/shinyACED/vrItems.csv")
```
```{r}
select(acedall,contains("Visual")) |>
  write.csv("data/shinyACED/picItems.csv")
```



Key -- not needed

## Group -- Condition/Race/Gender/Level



```{r}
select(acedall,Condition) |> 
  write.csv("data/shinyACED/condition.csv",
            row.names=FALSE)
```

```{r}
mutate(acedall,Gender1=as.integer(Gender=="Female")) |>
  select(Gender1) |> 
  write.csv("data/shinyACED/gender.csv",
            row.names=FALSE)
```

```{r}
select(acedall,Race) |> 
  write.csv("data/shinyACED/race.csv",
            row.names=FALSE)
```

```{r}
select(acedall,Level_Code) |> 
  write.csv("data/shinyACED/track.csv",
            row.names=FALSE)
```


## Criterion -- Pretest, posttest

```{r}
select(acedall,pre_scaled) |> 
  write.csv("data/shinyACED/pretest.csv",
            row.names=FALSE)
```

```{r}
select(acedall,post_scaled) |> 
  write.csv("data/shinyACED/posttest.csv",
            row.names=FALSE)
```


## Observed Score -- number right EAP

```{r}
select(acedall,Correct) |> 
  write.csv("data/shinyACED/correct.csv",
            row.names=FALSE)
```

The best "Score" from ACED is the EAP (expected value) for the Solve Geometric Problems node.

```{r}
select(acedall,EAP.sgp) |> 
  write.csv("data/shinyACED/aced_sgp.csv",
            row.names=FALSE)
```


# Pretest and Posttest

```{r}
pretestA <- read.csv("data/PretestAraw.csv")
pretestA |> filter(ItemID!="Key") |>
  select(!ItemID) |>
  write.csv("data/shinyACED/PretestAraw.csv",
            row.names=FALSE)
pretestA |> filter(ItemID=="Key") |>
  select(!ItemID) |>
  write.csv("data/shinyACED/Akey.csv")
```

```{r}
pretestB <- read.csv("data/PretestBraw.csv")
pretestB |> filter(ItemID!="Key") |>
  select(!ItemID) |>
  write.csv("data/shinyACED/PretestBraw.csv",
            row.names=FALSE)
pretestB |> filter(ItemID=="Key") |>
  select(!ItemID) |>
  write.csv("data/shinyACED/Bkey.csv")
```



# Equating pretest and posttest